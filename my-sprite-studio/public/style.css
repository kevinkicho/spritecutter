:root { --bg: #0f0f0f; --panel: #1e1e1e; --accent: #00bcd4; --text: #ddd; --border: #333; }
* { box-sizing: border-box; }
body { 
    margin: 0; background: var(--bg); color: var(--text); 
    font-family: 'Segoe UI', sans-serif; overflow: hidden; 
    position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
}

/* Layout */
.app-grid { display: flex; width: 100%; height: 100%; }
.editor-area { flex: 1; display: flex; flex-direction: column; background: #111; overflow: hidden; position: relative; }
.canvas-scroll-wrap { flex: 1; overflow: auto; display: flex; align-items: flex-start; justify-content: center; padding: 50px; }

/* Sidebar */
.ui-panel { width: 360px; min-width: 360px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; height: 100%; }
.panel-fixed { flex-shrink: 0; padding: 20px; background: #252525; border-bottom: 1px solid var(--border); z-index: 10; }
.panel-scroll { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 50px; }

/* Components */
.panel-title { margin: 0 0 10px 0; font-size: 1.1em; color: #fff; text-transform: uppercase; letter-spacing: 1px; }
.control-group { background: #252525; padding: 12px; border-radius: 6px; border: 1px solid #333; margin-bottom: 10px; }
label { font-size: 0.75em; color: #888; text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 8px; }

/* Click-to-Edit FPS Styles */
.editable-val { 
    color: var(--accent); cursor: pointer; border-bottom: 1px dashed var(--accent); margin: 0 5px; font-weight: bold; font-family: monospace; font-size: 1.1em;
}
.editable-val:hover { color: #fff; border-color: #fff; }
.fps-input { 
    width: 60px; background: #111; border: 1px solid var(--accent); color: #fff; 
    padding: 2px 5px; border-radius: 4px; font-family: monospace; font-weight: bold;
}

/* Accordions */
.accordion { border: 1px solid var(--border); border-radius: 4px; overflow: hidden; flex-shrink: 0; }
.acc-header { padding: 12px; background: #2a2a2a; cursor: pointer; font-size: 0.8em; font-weight: bold; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; color: #ccc; transition: background 0.2s; }
.acc-header:hover { background: #333; color: #fff; }
.acc-header.active { background: #222; color: var(--accent); border-bottom: 1px solid #333; }
.acc-header.active::after { content: '▲'; }
.acc-header::after { content: '▼'; font-size: 0.8em; }
.acc-content { display: none; padding: 15px; background: #1e1e1e; }
.acc-content.show { display: block; }

/* Grids */
.sequencer-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 6px; background: #111; padding: 8px; border-radius: 4px; border: 1px solid #333; max-height: 200px; overflow-y: auto; }
.seq-item { background: #333; color: #aaa; border: 1px solid #444; padding: 6px 0; text-align: center; border-radius: 4px; font-weight: bold; font-size: 0.85em; position: relative; cursor: pointer; user-select: none; transition: 0.2s; }
.seq-item:hover { background: #444; color: #fff; }
.seq-item.active { background: var(--accent); color: #000; border-color: #fff; box-shadow: 0 0 5px var(--accent); }
.remove-btn { position: absolute; top: -6px; right: -6px; width: 16px; height: 16px; background: #ff5252; color: white; border-radius: 50%; font-size: 10px; line-height: 16px; cursor: pointer; border: 2px solid var(--panel); z-index: 5; }

.preset-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 10px; }
.preset-btn { background: #333; color: #aaa; border: 1px solid #444; border-radius: 4px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
.preset-btn:hover { background: #444; color: #fff; border-color: #666; }

.preview-card { background: #000; padding: 10px; border: 1px solid var(--accent); border-radius: 8px; text-align: center; margin-top: 10px; transition: transform 0.2s; }
.preview-card:hover { transform: scale(1.02); border-color: #fff; }
canvas { image-rendering: pixelated; }

button.btn-zip { width: 100%; padding: 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; background: #7b1fa2; color: white; margin-top: 10px; }
.btn-ghost { background: #333; color: #ddd; width:100%; padding: 8px; border:1px solid #444; border-radius:4px; cursor:pointer; margin-top: 5px; }
.btn-ghost:hover { background: #444; color: #fff; }
.status-bar { background: #000; padding: 5px 10px; font-size: 0.8em; color: var(--accent); border-top: 1px solid #333; }

/* MODAL */
.modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; }
.modal.open { display: flex; }
.modal-content { background-color: #1e1e1e; padding: 20px; border: 1px solid #444; width: 95%; max-width: 900px; border-radius: 8px; position: relative; display: flex; flex-direction: column; gap: 15px; }
.close-modal { position: absolute; top: 10px; right: 15px; color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
.close-modal:hover { color: #fff; }

.modal-header { display: flex; justify-content: space-between; align-items: center; padding-right: 30px; }
.modal-stage { background: #111; border: 1px solid #333; border-radius: 4px; height: 400px; width: 100%; position: relative; overflow: hidden; }
#modalCanvas { display: block; width: 100%; height: 100%; cursor: zoom-in; }

/* Updated Controls */
.modal-controls { display: flex; justify-content: space-between; align-items: center; background: #252525; padding: 10px; border-radius: 4px; }
.play-controls { display: flex; align-items: center; gap: 10px; flex: 1; }
.speed-area { display: flex; align-items: center; gap: 10px; } /* Replaces zoom-controls in layout */

.btn-icon { width: 36px; height: 36px; padding: 0; font-size: 1.2em; display: flex; align-items: center; justify-content: center; background: #333; color: #fff; border: 1px solid #444; border-radius: 4px; cursor: pointer; }
.btn-icon:hover { background: #444; border-color: #666; }
.btn-icon.big { width: 44px; height: 44px; font-size: 1.4em; background: var(--accent); color: #000; border: none; }

/* Film Strip */
.film-strip-wrap { overflow-x: auto; background: #111; padding: 10px; border-radius: 4px; border: 1px solid #333; }
.film-strip { display: flex; gap: 5px; min-width: min-content; }
.film-item { width: 60px; height: 60px; background: #222; border: 1px solid #444; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border-radius: 4px; cursor: pointer; opacity: 0.6; position: relative; }
.film-item canvas { max-width: 100%; max-height: 100%; }
.film-item.active { border-color: var(--accent); box-shadow: 0 0 8px var(--accent); opacity: 1; transform: scale(1.05); }
.film-num { position: absolute; top: 2px; left: 4px; font-size: 10px; color: #fff; text-shadow: 1px 1px 2px #000; font-weight: bold; }

/* TUTORIAL OVERLAY */
#tutorialOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 5000; pointer-events: none; overflow: hidden; }
#tutorialOverlay.active { display: block; }
#tutorialSpotlight { position: absolute; border-radius: 8px; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.85); transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); pointer-events: none; border: 2px solid var(--accent); z-index: 5001; }
#tutorialCard { position: absolute; width: 300px; max-height: 80vh; overflow-y: auto; background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(10px); border: 1px solid #444; border-left: 4px solid var(--accent); padding: 20px; border-radius: 8px; color: #fff; pointer-events: auto; z-index: 5002; opacity: 0; transition: opacity 0.3s, transform 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
#tutorialCard.visible { opacity: 1; }
.t-header { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; color: var(--accent); }
.t-body { font-size: 0.9em; line-height: 1.5; color: #ddd; margin-bottom: 20px; }
.t-footer { display: flex; justify-content: space-between; align-items: center; }
.t-steps { font-size: 0.75em; color: #888; font-weight: bold; }
.btn-tut { padding: 6px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.8em; transition: 0.2s; }
.btn-tut.primary { background: var(--accent); color: #000; }
.btn-tut.primary:hover { background: #fff; }
.btn-tut.secondary { background: transparent; color: #aaa; }
.btn-tut.secondary:hover { color: #fff; }
