<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sprite Studio</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div class="app-grid">
        <section class="editor-area">
            <div class="canvas-scroll-wrap">
                <canvas id="sheetCanvas"></canvas>
            </div>
            <div class="status-bar" id="aiStatus">Ready</div>
        </section>

        <aside class="ui-panel">
            <div class="panel-fixed">
                <h2 class="panel-title">Sprite Studio Pro</h2>
                <div class="control-group" id="importStep">
                    <label>1. Import Sprite Sheet</label>
                    <input type="file" id="upload" accept="image/*" style="width:100%; padding: 8px; background: #111; border: 1px solid #444; border-radius: 4px;">
                </div>
            </div>

            <div class="panel-scroll">
                <div class="accordion">
                    <div class="acc-header active">1. Setup & Variations</div>
                    <div class="acc-content show">
                        <label>Sensitivity</label>
                        <div id="variationGrid" class="sequencer-grid" style="grid-template-columns: 1fr 1fr; max-height: 120px; margin-bottom:8px;"></div>
                        <button class="btn-ghost" onclick="resetCurrentVariation()">↺ Reset Variations</button>
                    </div>
                </div>

                <div class="accordion">
                    <div class="acc-header active">2. Anchors</div>
                    <div class="acc-content show">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; background:#222; padding:8px; border-radius:4px;">
                            <span style="font-size:0.75em; font-weight:bold;">TARGET:</span>
                            <div style="display:flex; gap:5px;">
                                <input type="checkbox" id="applyAll" style="width:auto; margin:0;">
                                <label for="applyAll" style="font-size:0.8em; margin:0; cursor:pointer;">ALL</label>
                            </div>
                        </div>
                        <div class="preset-grid">
                            <button class="preset-btn" onclick="applyPreset('top')">⬆</button>
                            <button class="preset-btn" onclick="applyPreset('bottom')">⬇</button>
                            <button class="preset-btn" onclick="applyPreset('left')">⬅</button>
                            <button class="preset-btn" onclick="applyPreset('right')">➡</button>
                            <button class="preset-btn" onclick="applyPreset('top-left')">↖</button>
                            <button class="preset-btn" onclick="applyPreset('top-right')">↗</button>
                            <button class="preset-btn" onclick="applyPreset('bottom-left')">↙</button>
                            <button class="preset-btn" onclick="applyPreset('bottom-right')">↘</button>
                        </div>
                        <button class="btn-ghost" onclick="resetAllAnchors()">↺ Reset Anchors</button>
                    </div>
                </div>

                <div class="accordion">
                    <div class="acc-header">3. Sequencer</div>
                    <div class="acc-content">
                        <label>Pool</label>
                        <div id="spritePool" class="sequencer-grid" style="margin-bottom:15px;"></div>
                        <label style="color:#00bcd4;">Loop <span id="frameCount" style="float:right; font-size:0.9em; color:#fff;">0</span></label>
                        <div id="sequencerList" class="sequencer-grid" style="min-height:80px; border:1px dashed #444;"></div>
                        <button class="btn-ghost" onclick="resetSequence()">↺ Reset Loop</button>
                    </div>
                </div>

                <div class="accordion">
                    <div class="acc-header">4. Export</div>
                    <div class="acc-content">
                        <label>Speed: <span id="fpsDisplaySidebar" class="editable-val" title="Click to Type FPS">12</span> FPS</label>
                        <input type="range" id="speedSlider" min="16" max="500" value="83" style="width:100%">
                        
                        <div class="preview-card" style="cursor:pointer;" title="Click to Inspect">
                            <canvas id="previewCanvas" width="128" height="128"></canvas>
                            <div id="previewNum" style="font-size:0.7em; color:#888; margin-top:5px;">Frame: 0</div>
                        </div>
                        <button id="zipBtn" class="btn-zip">Download ZIP</button>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <div id="animModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            
            <div class="modal-header">
                <h2 style="margin:0; color:#fff; font-size:1em;">Inspector</h2>
                <div id="modalFrameCounter" style="color:#00bcd4; font-weight:bold; font-size:0.9em;">Frame: 1 / 10</div>
            </div>
            
            <div class="modal-stage" id="modalStage">
                <canvas id="modalCanvas"></canvas>
                <div style="position:absolute; bottom:10px; right:10px; color:rgba(255,255,255,0.5); font-size:0.7em; pointer-events:none;">Scroll/Pinch to Zoom</div>
            </div>

            <div class="modal-controls">
                <div class="play-controls">
                    <button class="btn-icon" onclick="stepFrame(-1)" title="Previous">◀</button>
                    <button class="btn-icon big" id="playPauseBtn" onclick="togglePlay()" title="Space">⏸</button>
                    <button class="btn-icon" onclick="stepFrame(1)" title="Next">▶</button>
                </div>

                <div class="speed-area">
                    <label style="margin:0; font-size:0.8em; color:#aaa;">Speed:</label>
                    <span id="fpsDisplayModal" class="editable-val" title="Click to Type FPS">12</span>
                    <span style="font-size:0.8em; color:#aaa;">FPS</span>
                </div>
            </div>

            <div class="film-strip-wrap">
                <div id="filmStrip" class="film-strip"></div>
            </div>
        </div>
    </div>

    <div id="tutorialOverlay">
        <div id="tutorialSpotlight"></div>
        <div id="tutorialCard">
            <div class="t-header"><span id="tTitle">Welcome</span></div>
            <div class="t-body" id="tContent"></div>
            <div class="t-footer">
                <span class="t-steps" id="tStepCount">1 / 5</span>
                <div>
                    <button class="btn-tut secondary" onclick="skipTutorial()">Skip</button>
                    <button class="btn-tut primary" onclick="nextStep()">Next</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
